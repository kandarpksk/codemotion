<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>Codemotion Interface</title>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css">
	<link href="css/main.css" rel="stylesheet">
</head>
<body>
	<div class="container">
		<br>
		<br>
		<h1>{{ name }}</h1>
		[search]
		<br>
		<br>

		{{#each segments}}
		<div class="alert alert-info" role="alert" id="s{{start}}-vo">
			{{voiceover}}
		</div>

		<div class="row transcript">
			<div class="col-sm-5 video-container">
				<!-- http://codepen.io/ollieRogers/pen/lfeLc -->
				<video preload="metadata" id="s{{start}}-video">
					<source src="{{ url }}" type="video/mp4" />
					Your browser does not support HTML5 video.
				</video>

				<div id="scrubber">
					<div id="progress"></div>
				</div>
			</div>
			<div class="col">
				{{#each code}}
				<textarea style="display: none;"
						id="s{{../start}}l{{@index}}-code">{{ this.text }}</textarea>
				{{/each}}
				<div class="editor" id="s{{start}}-editor"
						data-language="{{ code.[0].language }}">{{ code.[0].text }}</div>
			</div>
			<div class="pills">
				<ul class="nav nav-pills">
					{{#each code}}
					<li class="nav-item">
						<a class="nav-link {{#if @first}} active {{/if}}"
								href="#" onclick="showCode(event, this)"
								data-s-index="{{../start}}" data-l-index="{{@index}}">
							{{ this.l }}
						</a>
					</li>
					{{/each}}
				</ul>
			</div>
		</div>

		{{/each}}
		<br>
	</div>

	<!-- todo: keep locally -->
	<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<!-- <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
	<script src="ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/initialize-ace.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/initialize-scrubbers.js" type="text/javascript" charset="utf-8"></script>
	<script>
		function showCode(event, e) {
			event.preventDefault()
			var s_index = $(e).data('s-index')
			var id = 's'+s_index + 'l'+$(e).data('l-index') + '-code'
			var text = document.getElementById(id).innerHTML
			var editor = ace.edit('s'+s_index+'-editor')
			editor.session.setValue(text)
			// language
		}

		function showScript() {
			{{#each segments}}
				var scriptDiv = $('#s'+{{start}}+'-vo')
				var time = Math.round($('#s'+{{start}}+'-video')[0].currentTime*100)/100
				scriptDiv.html('voiceover at '+time)
			{{/each}}
		}

		$(document).ready(function() {
			setInterval(showScript, 100)
			$('.editor').each(initializeAce)
			initializeScrubbers()
			$('.video-container video').click(function() {
				if (this.paused) this.play()
				else this.pause()
			})
		})
	</script>
</body>
</html>
